<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VisionPay - Klaim Hadiah</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
    
    <style>
        :root {
            --bg-color: #000000;
            --card-color: #0d0d0d;
            --accent-color: #ff3b30;
            --border-color: #1a1a1a;
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Montserrat', sans-serif;
            --side-margin: 22px; 
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shine {
            0% { left: -100%; }
            20% { left: 100%; }
            100% { left: 100%; }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-color); 
            color: #ececec; 
            font-family: var(--font-sans); 
            padding-bottom: 50px;
        }

        .animate-up { opacity: 0; animation: fadeInUp 0.5s ease forwards; }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }

header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 15px 20px; 
    

    position: fixed; 
    top: 0; 
    left: 0;
    right: 0;
    

    background: #0a0a0a; 
    
    z-index: 1000; 
    
    border-bottom: 1px solid #151515; 
}
body { 
    padding-top: 0px;
    padding-bottom: 100px;
}
.header-icons a {
    text-decoration: none;
    color: #fff;
    display: flex;
    align-items: center;
}
.header-icons .icon-vip {
    color: var(--accent-color); /* Tetap merah untuk VIP */
}
.header-icons {
    display: flex;
    gap: 12px; /* Jarak antar tombol */
    align-items: center;
}

.icon-box {
    width: 40px;
    height: 40px;
    background-color: #1a1a1a; /* Warna box bulat (sedikit lebih terang dari header) */
    border-radius: 50%; /* Membuat jadi bulat sempurna */
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    transition: background 0.3s ease;
}

.icon-box:active {
    background-color: #252525; /* Efek saat ditekan */
}

.icon-box i {
    font-size: 20px; /* Ukuran ikon di dalam box */
    color: #ffffff;
}

        .container { padding: 100px var(--side-margin) 0 var(--side-margin); }

        .hero-section { margin-bottom: 30px; }
        .hero-section h1 { font-family: var(--font-serif); font-size: 28px; font-weight: 700; color: #fff; margin-bottom: 8px; }
        .hero-section p { font-size: 11px; color: #777; line-height: 1.6; }

        /* CLAIM BOX */
        .claim-card {
            background: linear-gradient(145deg, #0d0d0d, #050505);
            border: 1px solid var(--border-color);
            padding: 25px 20px;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            margin-bottom: 35px;
        }
        .claim-card::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.03), transparent);
            transform: skewX(-25deg); animation: shine 5s infinite;
        }

        .section-title { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
        .section-title i { color: var(--accent-color); font-size: 18px; }
        .section-title h3 { font-size: 14px; font-weight: 700; color: #fff; }

        .bonus-input {
            width: 100%; background: #000; border: 1px solid #222;
            border-radius: 12px; padding: 16px; color: #fff;
            font-size: 16px; font-weight: 600; text-align: center;
            letter-spacing: 2px; text-transform: uppercase; outline: none;
        }

        .btn-claim {
            width: 100%; background: var(--accent-color); color: #fff; border: none;
            padding: 15px; border-radius: 12px; font-family: var(--font-serif);
            font-weight: 700; font-size: 14px; margin-top: 15px; cursor: pointer;
        }

        /* INTRUKSI */
        .instruction-list { margin-bottom: 40px; }
        .ins-item { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 15px; }
        .ins-item i { color: var(--accent-color); font-size: 14px; margin-top: 2px; }
        .ins-item p { font-size: 11px; color: #666; line-height: 1.5; }

/* TAB RIWAYAT GAYA KEREN */
.history-section { margin-top: 20px; }

.history-item {
    background: #0a0a0a; /* Warna gelap solid agar seragam */
    border: 1px solid #151515;
    padding: 18px 16px; 
    border-radius: 16px;
    display: flex; 
    justify-content: space-between; 
    align-items: center;
    margin-bottom: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.hist-info { display: flex; flex-direction: column; gap: 4px; }

/* Nama Kode */
.hist-info h4 { 
    font-size: 13px; 
    color: #ffffff; 
    font-weight: 700; 
    letter-spacing: 0.5px;
}

/* Waktu */
.hist-info span { 
    font-size: 10px; 
    color: #555; 
    font-weight: 400;
    letter-spacing: 0.2px;
}

.hist-amount { text-align: right; }

/* Jumlah Saldo - Hijau sesuai halaman riwayat */
.amount-val { 
    font-size: 14px; 
    color: #4cd964; /* Hijau Standar VisionPay */
    font-weight: 700; 
    display: block; 
    margin-bottom: 6px;
}

/* Status: Berhasil (Pill Style) */
.status-label { 
    font-size: 9px; 
    color: #4cd964; 
    background: rgba(76, 217, 100, 0.1); 
    padding: 3px 10px; 
    border-radius: 6px;
    font-weight: 700;
    display: inline-block;
}

/* --- POPUP OVERLAY SYSTEM --- */
.overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.97); display: none; align-items: center; 
    justify-content: center; z-index: 10000; backdrop-filter: blur(10px);
}

.popup-card {
    background: #000; border: 1px solid #222; width: 220px; 
    padding: 35px 20px; border-radius: 30px; text-align: center;
    transform: scale(0.8); opacity: 0; transition: 0.3s cubic-bezier(0.17, 0.89, 0.32, 1.27);
}
.popup-card.show { transform: scale(1); opacity: 1; }

/* SPINNER ICON */
.spin-container { width: 40px; height: 40px; margin: 0 auto 15px; }
.spinning-red { animation: rotate 0.8s linear infinite; width: 40px; height: 40px; }
.circle-bg { fill: none; stroke: #1a1a1a; stroke-width: 4; }
.circle-bar { 
    fill: none; stroke: var(--accent-color); stroke-width: 4; 
    stroke-dasharray: 80; stroke-dashoffset: 40; stroke-linecap: round; 
}
@keyframes rotate { 100% { transform: rotate(360deg); } }

/* ICON SIZE FIX */
.check-icon { 
    font-size: 32px !important; /* Ukuran pas, tidak kebesaran */
    margin-bottom: 12px; 
    display: none; 
}
    </style>
</head>
<body>

<header>
    <a href="beranda.html">
        <img src="logo.jpg" alt="VisionPay" style="height: 40px; width: auto; display: block;">
    </a>
    
    <div class="header-icons">
        <a href="vip.html" class="icon-box">
            <i class="ri-vip-crown-fill"></i>
        </a>
        
        <a href="customer-service.html" class="icon-box">
            <i class="ri-customer-service-2-fill"></i>
        </a>
        
        <a href="film.html" class="icon-box">
            <i class="ri-video-line"></i>
        </a>
    </div>
</header>

    <div class="container">
        
        <div class="hero-section animate-up">
            <h1>Klaim hadiah</h1>
            <p>Tukarkan kode promo Anda untuk mendapatkan bonus saldo langsung ke dompet utama.</p>
        </div>

        <div class="claim-card animate-up delay-1">
            <div class="section-title"><i class="ri-gift-line"></i><h3>Input Kode Bonus</h3></div>
            <input type="text" class="bonus-input" placeholder="Ketik Kode" id="bonusCode">
            <button class="btn-claim" onclick="processClaim()">Konfirmasi Kode</button>
        </div>

        <div class="instruction-list animate-up delay-2">
            <div class="section-title"><i class="ri-information-line"></i><h3>Instruksi Klaim</h3></div>
            <div class="ins-item">
                <i class="ri-checkbox-circle-line"></i>
                <p>Setiap kode hadiah hanya dapat diklaim satu kali oleh satu akun pengguna.</p>
            </div>
            <div class="ins-item">
                <i class="ri-checkbox-circle-line"></i>
                <p>Bonus akan langsung ditambahkan ke saldo akun setelah verifikasi sistem berhasil.</p>
            </div>
        </div>

        <div class="history-section animate-up delay-3">
            <div class="section-title"><i class="ri-history-line"></i><h3>Riwayat Klaim</h3></div>
            
            <div class="history-item">
                <div class="hist-info">
                    <h4>NEWYEAR2025</h4>
                    <span>29 Des 2025, 20:15</span>
                </div>
                <div class="hist-amount">
                    <span class="amount-val">+ Rp 50.000</span>
                    <span class="status-label">Berhasil</span>
                </div>
            </div>

            <div class="history-item">
                <div class="hist-info">
                    <h4>WELCOMEVIP</h4>
                    <span>25 Des 2025, 14:10</span>
                </div>
                <div class="hist-amount">
                    <span class="amount-val">+ Rp 25.000</span>
                    <span class="status-label">Berhasil</span>
                </div>
            </div>
        </div>
<div class="overlay" id="overlay">
    <div class="popup-card" id="popup">
        <div id="loader">
            <div class="spin-container">
                <svg class="spinning-red" viewBox="0 0 45 45">
                    <circle class="circle-bg" cx="22.5" cy="22.5" r="20"></circle>
                    <circle class="circle-bar" cx="22.5" cy="22.5" r="20"></circle>
                </svg>
            </div>
        </div>
        <i class="ri-checkbox-circle-fill check-icon" id="checkIcon" style="color: var(--accent-color);"></i>
        <i class="ri-close-circle-fill check-icon" id="errorIcon" style="color: var(--accent-color);"></i>
        
        <h3 id="popTitle" style="font-family: var(--font-serif); font-size: 15px; color: #fff; margin-top: 5px;">Memverifikasi...</h3>
        <p id="popSub" style="font-size: 10px; color: #666; margin-top: 5px;">Keamanan enkripsi aktif.</p>
    </div>
</div>
<div style="margin-top: 30px; text-align: center;" class="animate-up">
    <a href="profil.html" style="display: inline-block; margin-top: 15px; color: red; font-size: 13px; text-decoration: none;">Kembali</a>
    </div>
    <script>/* DATABASE KODE */
/* DATABASE KODE */
const GIFT_CODES = {
    // Kode untuk Saldo Tersedia (Bisa ditarik)
    "VISION2025": { reward: 50000, label: "Bonus VisionPay 2025", target: "tersedia" },
    "MEMBERBARU": { reward: 25000, label: "Bonus Member Baru", target: "tersedia" },
    "HAPPYNEWYEAR2026VSP": { reward: 4500, label: "Bonus Member Baru", target: "tersedia" },
    "VSP": { reward: 4500, label: "Bonus Member Baru", target: "tersedia" },
    "YTY": { reward: 4500, label: "Bonus Member Baru", target: "tersedia" },
    
    // Kode untuk Saldo Deposit (Untuk modal/investasi)
    "MODALGRATIS": { reward: 100000, label: "Bonus Deposit Awal", target: "deposit" },
        "VSP890": { reward: 170000, label: "Bonus Deposit Awal", target: "deposit" },
    "PROMOJANUARI": { reward: 15000, label: "Voucher Deposit Januari", target: "deposit" }
};

/* FUNGSI UTAMA KLAIM */
function processClaim() {
    const code = document.getElementById('bonusCode').value.trim().toUpperCase();
    const userId = localStorage.getItem("currentUser");
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let userIndex = users.findIndex(u => u.id === userId);

    if (userIndex === -1) return window.location.href = "daftar.html";

    showPopupStatus({ mode: 'loading' });

    setTimeout(() => {
        const gift = GIFT_CODES[code];
        
        if (!gift || (users[userIndex].claimedCodes || []).includes(code)) {
            showPopupStatus({ mode: 'error', title: "Gagal", sub: "Kode tidak valid atau sudah diklaim" });
            return;
        }

        /* LOGIKA PEMISAHAN SALDO */
        if (gift.target === "deposit") {
            // Masuk ke Saldo Deposit
            users[userIndex].saldo.deposit = (users[userIndex].saldo.deposit || 0) + gift.reward;
        } else {
            // Masuk ke Saldo Tersedia (Default)
            users[userIndex].saldo.tersedia += gift.reward;
        }

        // Simpan log penggunaan kode
        users[userIndex].claimedCodes = users[userIndex].claimedCodes || [];
        users[userIndex].claimedCodes.push(code);

        // Catat di Riwayat
        const now = new Date();
        const waktuLengkap = `${now.getDate()} ${now.toLocaleString('id-ID',{month:'short'})} ${now.getFullYear()}, ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
        
        users[userIndex].catatan = users[userIndex].catatan || [];
        users[userIndex].catatan.unshift({
            tipe: "klaim_hadiah",
            judul: gift.label,
            keterangan: `Kode: ${code} (${gift.target === "deposit" ? "Ke Deposit" : "Ke Saldo Utama"})`,
            tanggal: waktuLengkap,
            total: gift.reward,
            status: "Berhasil"
        });

        localStorage.setItem("users", JSON.stringify(users));

        /* TAMPILKAN SUKSES */
        showPopupStatus({
            mode: 'success',
            title: "Klaim Berhasil",
            sub: `Bonus ditambahkan +Rp ${gift.reward.toLocaleString()}`
        });

        // Popup lama (8 detik) agar user bisa screenshot
        setTimeout(() => {
            location.reload();
        }, 8000);

    }, 1500);
}

/* KONTROL POPUP */
function showPopupStatus({ mode, title, sub }) {
    const overlay = document.getElementById('overlay');
    const popup = document.getElementById('popup');
    const loader = document.getElementById('loader');
    const checkIcon = document.getElementById('checkIcon');
    const errorIcon = document.getElementById('errorIcon');
    const pTitle = document.getElementById('popTitle');
    const pSub = document.getElementById('popSub');

    overlay.style.display = 'flex';
    setTimeout(() => popup.classList.add('show'), 10);

    if (mode === 'loading') {
        loader.style.display = 'block';
        checkIcon.style.display = 'none';
        errorIcon.style.display = 'none';
        pTitle.innerText = "Memverifikasi...";
        pSub.innerText = "Keamanan enkripsi aktif.";
    } else if (mode === 'success') {
        loader.style.display = 'none';
        checkIcon.style.display = 'block';
        errorIcon.style.display = 'none';
        pTitle.innerText = title;
        pSub.innerText = sub;
        // Tidak ada auto-close di sini agar user bisa SS, refresh diatur oleh processClaim
    } else if (mode === 'error') {
        loader.style.display = 'none';
        checkIcon.style.display = 'none';
        errorIcon.style.display = 'block';
        pTitle.innerText = title;
        pSub.innerText = sub;
        setTimeout(() => closePopup(), 2500);
    }
}

function closePopup() {
    const overlay = document.getElementById('overlay');
    const popup = document.getElementById('popup');
    if(popup) popup.classList.remove('show');
    setTimeout(() => { overlay.style.display = 'none'; }, 300);
}

// Render Riwayat
// Render Riwayat - Hanya Nama Kode Murni
function renderHistory() {
    const userId = localStorage.getItem("currentUser");
    const users = JSON.parse(localStorage.getItem("users")) || [];
    const user = users.find(u => u.id === userId);
    const historyContainer = document.querySelector('.history-section');
    
    if (!user || !user.catatan) return;
    
    // Bersihkan daftar dummy agar tidak double
    const oldItems = historyContainer.querySelectorAll('.history-item');
    oldItems.forEach(el => el.remove());

    const claims = user.catatan.filter(c => c.tipe === "klaim_hadiah");
    
    claims.forEach(c => {
        // Mengambil kode murni dari keterangan
        // Misal dari "Kode: VISION2025 (Ke Saldo Utama)" diambil "VISION2025" saja
        let rawText = c.keterangan;
        let pureCode = rawText.replace("Kode: ", "").split(" ")[0];

        const html = `
            <div class="history-item animate-up">
                <div class="hist-info">
                    <h4 style="letter-spacing: 1px;">${pureCode}</h4>
                    <span>${c.tanggal}</span>
                </div>
                <div class="hist-amount">
                    <span class="amount-val">+ Rp ${c.total.toLocaleString('id-ID')}</span>
                    <span class="status-label">Berhasil</span>
                </div>
            </div>`;
        historyContainer.insertAdjacentHTML('beforeend', html);
    });
}
document.addEventListener("DOMContentLoaded", renderHistory);</script>

</body>
</html>